version: '3.8'

services:
  pihole:
    container_name: pihole
    image: pihole/pihole:latest

    # 👇 Required ports
    ports:
      - "53:53/tcp"
      - "53:53/udp"
      - "67:67/udp" # Only if DHCP is enabled
      - "80:80"     # Web UI
      - "443:443"   # Optional SSL for admin

    # ✅ DNS resolution & static hostname
    hostname: pihole
    domainname: local

    # 🔐 ENV configuration from external secrets file
    env_file:
      - ./pihole.env

    # ✅ Volumes for persistence
    volumes:
      - pihole_etc:/etc/pihole
      - dnsmasq_etc:/etc/dnsmasq.d

    # 👇 Critical for container networking (non-root DNS)
    cap_add:
      - NET_ADMIN  # Required for DHCP

    restart: unless-stopped

    # 🧼 Clean, isolated network (can be joined with other containers)
    networks:
      pihole_net:
        ipv4_address: 192.168.10.2

# 👇 Isolated network
networks:
  pihole_net:
    driver: bridge
    ipam:
      config:
        - subnet: 192.168.10.0/24

volumes:
  pihole_etc:
  dnsmasq_etc:
